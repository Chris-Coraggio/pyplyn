
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Pyplyn Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#what-does-pyplyn-solve" class="toc-h1 toc-link" data-title="What does Pyplyn solve?">What does Pyplyn solve?</a>
          </li>
          <li>
            <a href="#overview" class="toc-h1 toc-link" data-title="Overview">Overview</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#key-features" class="toc-h2 toc-link" data-title="Key features">Key features</a>
                  </li>
                  <li>
                    <a href="#improvements-from-release-9-x" class="toc-h2 toc-link" data-title="Improvements from release 9.x">Improvements from release 9.x</a>
                  </li>
                  <li>
                    <a href="#planned-development" class="toc-h2 toc-link" data-title="Planned development">Planned development</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#concepts" class="toc-h1 toc-link" data-title="Concepts">Concepts</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#appconfig" class="toc-h2 toc-link" data-title="AppConfig">AppConfig</a>
                  </li>
                  <li>
                    <a href="#appconfig-global" class="toc-h2 toc-link" data-title="AppConfig.Global">AppConfig.Global</a>
                  </li>
                  <li>
                    <a href="#appconfig-alert" class="toc-h2 toc-link" data-title="AppConfig.Alert">AppConfig.Alert</a>
                  </li>
                  <li>
                    <a href="#appconfig-hazelcast" class="toc-h2 toc-link" data-title="AppConfig.Hazelcast">AppConfig.Hazelcast</a>
                  </li>
                  <li>
                    <a href="#connectors" class="toc-h2 toc-link" data-title="Connectors">Connectors</a>
                  </li>
                  <li>
                    <a href="#token-based-authentication" class="toc-h2 toc-link" data-title="Token-based authentication">Token-based authentication</a>
                  </li>
                  <li>
                    <a href="#mutual-tls-authentication" class="toc-h2 toc-link" data-title="Mutual TLS authentication">Mutual TLS authentication</a>
                  </li>
                  <li>
                    <a href="#configurations" class="toc-h2 toc-link" data-title="Configurations">Configurations</a>
                  </li>
                  <li>
                    <a href="#transmutation" class="toc-h2 toc-link" data-title="Transmutation">Transmutation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#data-sources" class="toc-h1 toc-link" data-title="Data sources">Data sources</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#argus" class="toc-h2 toc-link" data-title="Argus">Argus</a>
                  </li>
                  <li>
                    <a href="#influxdb" class="toc-h2 toc-link" data-title="InfluxDB">InfluxDB</a>
                  </li>
                  <li>
                    <a href="#refocus" class="toc-h2 toc-link" data-title="Refocus">Refocus</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#transformations" class="toc-h1 toc-link" data-title="Transformations">Transformations</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#highestvalue" class="toc-h2 toc-link" data-title="HighestValue">HighestValue</a>
                  </li>
                  <li>
                    <a href="#infostatus" class="toc-h2 toc-link" data-title="InfoStatus">InfoStatus</a>
                  </li>
                  <li>
                    <a href="#metadata" class="toc-h2 toc-link" data-title="Metadata">Metadata</a>
                  </li>
                  <li>
                    <a href="#lastdatapoint" class="toc-h2 toc-link" data-title="LastDatapoint">LastDatapoint</a>
                  </li>
                  <li>
                    <a href="#savemetricmetadata" class="toc-h2 toc-link" data-title="SaveMetricMetadata">SaveMetricMetadata</a>
                  </li>
                  <li>
                    <a href="#threshold" class="toc-h2 toc-link" data-title="Threshold">Threshold</a>
                  </li>
                  <li>
                    <a href="#thresholdmetforduration" class="toc-h2 toc-link" data-title="ThresholdMetForDuration">ThresholdMetForDuration</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#load-destinations" class="toc-h1 toc-link" data-title="Load destinations">Load destinations</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#refocus-as-a-destination" class="toc-h2 toc-link" data-title="Refocus as a destination">Refocus as a destination</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#quickstart" class="toc-h1 toc-link" data-title="Quickstart">Quickstart</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#prerequisites" class="toc-h2 toc-link" data-title="Prerequisites">Prerequisites</a>
                  </li>
                  <li>
                    <a href="#configure-and-run-pyplyn" class="toc-h2 toc-link" data-title="Configure and run Pyplyn">Configure and run Pyplyn</a>
                  </li>
                  <li>
                    <a href="#base64-mime-encoding" class="toc-h2 toc-link" data-title="BASE64-MIME encoding">BASE64-MIME encoding</a>
                  </li>
                  <li>
                    <a href="#create-a-configuration-for-processing" class="toc-h2 toc-link" data-title="Create a configuration for processing">Create a configuration for processing</a>
                  </li>
                  <li>
                    <a href="#startup-script-bin-pyplyn-sh" class="toc-h2 toc-link" data-title="Startup script (bin/pyplyn.sh)">Startup script (bin/pyplyn.sh)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#extending-pyplyn" class="toc-h1 toc-link" data-title="Extending Pyplyn">Extending Pyplyn</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#common-use-cases" class="toc-h2 toc-link" data-title="Common use-cases">Common use-cases</a>
                  </li>
                  <li>
                    <a href="#how-do-i-replace-augment-pyplyn-39-s-bootstrap" class="toc-h2 toc-link" data-title="How do I replace/augment Pyplyn's bootstrap?">How do I replace/augment Pyplyn's bootstrap?</a>
                  </li>
                  <li>
                    <a href="#how-do-i-create-a-new-transform" class="toc-h2 toc-link" data-title="How do I create a new Transform?">How do I create a new Transform?</a>
                  </li>
                  <li>
                    <a href="#starting-stopping-a-pyplyn-extension-project" class="toc-h2 toc-link" data-title="Starting/stopping a Pyplyn-extension project">Starting/stopping a Pyplyn-extension project</a>
                  </li>
                  <li>
                    <a href="#tech-stack" class="toc-h2 toc-link" data-title="Tech stack">Tech stack</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#contributing-to-pyplyn" class="toc-h1 toc-link" data-title="Contributing to Pyplyn">Contributing to Pyplyn</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#licensing-requirements" class="toc-h2 toc-link" data-title="Licensing requirements">Licensing requirements</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href="https://github.com/salesforce/pyplyn">Pyplyn repository on GitHub.com</a></li>
            <li><a href="https://github.com/tripit/slate">Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p><img src="images/pyplyn-logo-full.png" alt="Pyplyn: a scalable time-series data collector" /></p>

<p>Pyplyn (meaning <em><em>pipeline</em></em> in <a href="https://translate.google.com/#af/en/pyplyn">Afrikaans</a>) is an open source tool that 
extracts data from various sources, transforms and gives it meaning, and sends it to other systems for consumption.</p>

<p>Pyplyn was written to allow teams in Salesforce to power real-time health dashboards that go beyond one-to-one mapping of time-series data to visual artifacts.</p>

<p>One example of such a use case is ingesting time-series data stored in <a href="https://github.com/Salesforce/Argus">Argus</a> and <a href="https://github.com/Salesforce/refocus">Refocus</a>, processing multiple metrics together (with context), and displaying the result in Refocus (as red, yellow, or green lights).</p>

<p><img src="images/pyplyn-system-diagram.png" alt="Pyplyn System Diagram" /></p>
<h1 id='what-does-pyplyn-solve'>What does Pyplyn solve?</h1>
<p>A time-series of historical data works well for understanding the evolution of metrics over time, but it doesn&#39;t give you much help when it comes to explaining what the data means <em>right now</em>.</p>

<p>Take a look at the following example:</p>

<p><img src="images/time-series-example.png" alt="Time series" /></p>

<p>This chart shows two metrics and a threshold. But, at a glance, it doesn&#39;t really tell you if there&#39;s a problem or not. Your attention is drawn towards the two spikes, which may or may not be the most relevant thing. It&#39;s also not clear what the <em>threshold</em> applies to: is the errors per minute, or the response time? (And, is the <em>average</em> response time above or below the threshold?)</p>

<p>Providing enough information to allow engineers to determine <em><strong>health</strong></em>, using line charts alone, is a tall order. In most cases, it requires too much visual interpretation to be helpful in a time-critical situation.</p>

<p>This is where <a href="https://medium.com/salesforce-open-source/take-a-moment-to-refocus-86b6546c90c#c169">Refocus steps in</a>, and <strong>why Pyplyn exists</strong>: to complement Refocus&#39;s visualization capabilities by providing a robust pipeline that feeds dashboards with fresh data.</p>
<h1 id='overview'>Overview</h1>
<p><img src="images/pyplyn-how-does-it-work.png" alt="How does Pyplyn work" /></p>
<h2 id='key-features'>Key features</h2>
<ul>
<li>Simple and reliable data pipeline with support for various transformations</li>
<li><strong>No code required</strong> - Uses a JSON-based syntax</li>
<li>Flexible multi-stage source/transformation/destination logic</li>
<li>Developed with support for extension via easy-to-grasp Java code</li>
<li>Highly available and scalable (the pipeline can be partitioned across multiple nodes)</li>
<li>Configurations can be added/updated/removed without restarting the process</li>
<li>Publishes operational metrics (errors, p95, etc.) for monitoring service health</li>
</ul>
<h2 id='improvements-from-release-9-x'>Improvements from release 9.x</h2>
<ul>
<li>Faster processing speed with the use of RxJava (4.3x faster, tested on our reference dataset)</li>
<li>Cleaner code, mainly after converting models <em>Immutables</em>-annotated abstract classes</li>
<li>Support mutual TLS authentication for endpoints, by specifying a Java keystore and password</li>
<li>Connect, read, and write timeouts can now be specified for each <em>connector</em></li>
<li>All <em>Jackson</em>-based models can now be serialized (with the <em>type</em> specifier field)</li>
<li><code>AppConfig.Global.minRepeatIntervalMillis</code> was deprecated (replaced with <code>AppConfig.Global.runOnce</code>)</li>
<li>Bash script for managing the service&#39;s lifecycle (start, stop, restart, logs, etc.)</li>
<li>Since <em>10.0.0</em>, Pyplyn releases follow <a href="http://semver.org/">Semantic versioning</a> guidelines.</li>
</ul>
<h2 id='planned-development'>Planned development</h2><h3 id='breaking-changes'>Breaking changes</h3>
<ul>
<li>Remove <em>AppConfig.Global.minRepeatIntervalMillis</em></li>
<li>Rename <em>HighestValue.messageCodeSource</em> to <em>tagMessageCode</em></li>
<li>Rename the <em>configurations</em> moniker since it has proven confusing (in relation to <code>AppConfig</code>)</li>
</ul>
<h3 id='roadmap'>Roadmap</h3>
<ul>
<li>Extract source: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_query.htm">Execute a Salesforce SOQL query</a></li>
<li>Load destination: Email (via SMTP MTA)</li>
<li>Load destination: <a href="https://developer.salesforce.com/docs/atlas.en-us.chatterapi.meta/chatterapi/quickreference_post_feed_item.htm">Post a Salesforce Chatter Feed Item</a></li>
<li>Load destination: <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_create.htm">Create a Salesforce Record</a></li>
<li>API for managing configurations</li>
<li>API for managing connectors</li>
<li>Multi-tenancy (support configurations and connectors belonging to different users)</li>
<li>Include Pyplyn in the <a href="https://search.maven.org/">Maven central</a> repository</li>
</ul>
<h1 id='concepts'>Concepts</h1>
<p>Let&#39;s start with an overview of a few basic concepts in Pyplyn.</p>
<h2 id='appconfig'>AppConfig</h2>
<p>The <a href="https://github.com/salesforce/pyplyn/blob/master/duct/src/main/java/com/salesforce/pyplyn/duct/appconfig/AppConfig.java">AppConfig</a> represents the primary object used to configure Pyplyn&#39;s behavior (endpoint connectors, the path to configurations, self-monitoring alerting threshold, and high-availability settings).</p>

<p>The application config has three sections: <em>global</em>, <em>alert</em>, and <em>hazelcast</em>; they are explained below.</p>
<h2 id='appconfig-global'>AppConfig.Global</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"global"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"configurationsPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/configurations/dir"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"connectorsPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/connectors.json"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"updateConfigurationIntervalMillis"</span><span class="p">:</span><span class="w"> </span><span class="mi">300000</span><span class="w">
    </span><span class="s2">"runOnce"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="p">},</span><span class="w">

  </span><span class="s2">"alert"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"checkIntervalMillis"</span><span class="p">:</span><span class="w"> </span><span class="mi">60000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"thresholds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"MeterNameMeterTypeStatusCode"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">

  </span><span class="s2">"hazelcast"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/hazelcast.xml"</span><span class="w">
    </span><span class="s2">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This is the only mandatory section of the <em>AppConfig</em>. See the following explanations as to what each of these parameters does:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>configurationsPath</td>
<td>required</td>
<td>This should point to a directory which contains the Pyplyn <a href="#configurations">configurations</a> to process</td>
</tr>
<tr>
<td>connectorsPath</td>
<td>required</td>
<td>A single JSON file which lists service endpoint <a href="#connectors">connectors</a> used by Pyplyn&#39;s plugin to extract data and push results</td>
</tr>
<tr>
<td>updateConfigurationIntervalMillis</td>
<td>required</td>
<td>The number of milliseconds at which Pyplyn periodically reloads all configurations from disk (if any configurations are removed from this directory, they will no longer be processed after the configuration update process&#39; next run)</td>
</tr>
<tr>
<td>ioPoolsThreadSize</td>
<td>optional</td>
<td>Defaults to 100 threads per IO pool; can be updated to increase or decrease the number of threads in the dedicated <em>Extract</em> and <em>Load</em> thread pools (for tweaking performance depending on the deployment hosts)</td>
</tr>
<tr>
<td>runOnce</td>
<td>optional</td>
<td>Defaults to <em>false</em>, which means the service runs indefinitely or until terminated by the host OS; set to <em>true</em> to process the specified <em>configurations</em> only once, then exit (useful if you want to run Pyplyn with <code>crontab</code>, or for testing)</td>
</tr>
</tbody></table>
<h2 id='appconfig-alert'>AppConfig.Alert</h2>
<blockquote>
<p>Pyplyn will report a status of <em>CRITICAL</em> if it registers less than 25 successful Refocus extract operations in the specified <em>checkIntervalMillis</em></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="s2">"RefocusExtractSuccessCRIT"</span><span class="p">:</span><span class="w"> </span><span class="mf">25.0</span><span class="w">
</span></code></pre>
<blockquote>
<p>Pyplyn will report a status of <em>WARNING</em> if it registers <em>more than</em> 25 failed Refocus authentication attempts in the specified <em>checkIntervalMillis</em></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="s2">"RefocusAuthenticationFailureWARN"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="w">
</span></code></pre>
<blockquote>
<p>The <strong>less than / more than</strong> logic is determined by the corresponding <strong>MeterType</strong> (e.g., <em>ExtractSuccess</em> and <em>AuthenticationFailure</em>).</p>
</blockquote>

<p>This section is used to configure Pyplyn&#39;s health metrics and monitoring.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>checkIntervalMillis</td>
<td>optional</td>
<td>The number of milliseconds at which Pyplyn checks its health, based on internally collected metrics, and outputs its status; defaults to 300,000 ms (5 minutes)</td>
</tr>
<tr>
<td>enabled</td>
<td>optional</td>
<td>Defaults to <em>false</em>; set to <em>true</em> to have Pyplyn output its health to the system&#39;s console</td>
</tr>
<tr>
<td>thresholds</td>
<td>optional</td>
<td>A <code>Map&lt;String, Double&gt;</code>, specifying alerting thresholds for various parts of the system (more below); if not specified, it will default to an empty map</td>
</tr>
</tbody></table>

<p>The key specified in the <em>thresholds</em> map determines each value&#39;s scope.  The names are formed by concatenating three identifiers:</p>

<p>1. <code>MeterName</code>: points to the type of service being queries, e.g., Argus, Refocus, InfluxDB, etc.
2. <code>MeterType</code>: an enumeration of available operation types, defined in <a href="https://github.com/salesforce/pyplyn/blob/master/plugin-api/src/main/java/com/salesforce/pyplyn/status/MeterType.java">MeterType.java</a>; each type also defines the logic to use for comparison (<em>GREATER_THAN</em> or <em>LESS_THAN</em>)
3. <code>StatusCode</code>: <a href="https://github.com/salesforce/pyplyn/blob/master/plugin-api/src/main/java/com/salesforce/pyplyn/model/StatusCode.java">StatusCode.java</a></p>
<h2 id='appconfig-hazelcast'>AppConfig.Hazelcast</h2>
<blockquote>
<p>Configure the username and password to use (limiting access to the cluster to authorized parties)</p>
</blockquote>
<pre class="highlight xml tab-xml"><code><span class="nt">&lt;group&gt;</span>
  <span class="nt">&lt;name&gt;</span>USERNAME<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;password&gt;</span>PASSWORD<span class="nt">&lt;/password&gt;</span>
<span class="nt">&lt;/group&gt;</span>
</code></pre>
<blockquote>
<p>Add the list of members that make up the cluster, as <code>&lt;member/&gt;</code> entries (one host per line)</p>
</blockquote>
<pre class="highlight xml tab-xml"><code>    <span class="nt">&lt;network&gt;</span>
        <span class="nt">&lt;join&gt;</span>
            <span class="nt">&lt;tcp-ip</span> <span class="na">enabled=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;member&gt;</span>127.0.0.1<span class="nt">&lt;/member&gt;</span>
            <span class="nt">&lt;/tcp-ip&gt;</span>
        <span class="nt">&lt;/join&gt;</span>
    <span class="nt">&lt;/network&gt;</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>enabled</td>
<td>optional</td>
<td>Defaults to <em>false</em>; set to <em>true</em> to allow Pyplyn to work in a multi-node <a href="https://hazelcast.org/">Hazelcast</a> clustering</td>
</tr>
<tr>
<td>config</td>
<td>required</td>
<td>Specifies the path to an XML used to configure the cluster. The available options are described in detail Hazelcast&#39;s <a href="http://docs.hazelcast.org/docs/3.8.1/manual/html-single/index.html">documentation</a></td>
</tr>
</tbody></table>

<p>To run Pyplyn in cluster mode, take a look at the <a href="https://github.com/salesforce/pyplyn/blob/master/blob/master/duct/src/main/resources/hazelcast.example.xml">hazelcast.example.xml</a> configuration file.</p>
<h2 id='connectors'>Connectors</h2>
<blockquote>
<p>Refocus: without authentication</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-without-authentication"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-refocus-instance/v1/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Refocus: username and password
<strong>Remember: all passwords need to be <a href="#base64-mime-encoding">BASE64-encoded</a></strong>!</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-user-and-pass"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-refocus-instance/v1/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE64-encoded-password-string"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Argus: username and password</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-argus-instance/argusws/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE64-encoded-password-string"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Argus: with custom timeouts (30/40/50 seconds)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-argus-instance/argusws/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE64-encoded-Argus-refresh-token"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"connectTimeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w">
  </span><span class="s2">"readTimeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w">
  </span><span class="s2">"writeTimeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Endpoint connectors are collections of settings that define a remote host to/from which data can be pushed, or loaded.</p>

<p>Each connector should be defined in the <em>connectors.json</em> file; see the available parameter list below:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>required</td>
<td>Unique identifier used in various Pyplyn objects, to refer to this endpoint</td>
</tr>
<tr>
<td>endpoint</td>
<td>required</td>
<td>The URL of the service represented by this connector</td>
</tr>
<tr>
<td>username</td>
<td>optional</td>
<td>Username used for authentication, or null if not required</td>
</tr>
<tr>
<td>password</td>
<td>optional</td>
<td>Password required for authenticating to this endpoint, or null if not required; this string <strong>should be <a href="#base64-mime-encoding">BASE64 encoded</a></strong></td>
</tr>
<tr>
<td>proxyHost</td>
<td>optional</td>
<td>A hostname pointing to an HTTP proxy, or null if not used</td>
</tr>
<tr>
<td>proxyPort</td>
<td>optional</td>
<td>The port the proxy listens on, or null if not used</td>
</tr>
<tr>
<td>connectTimeout</td>
<td>optional</td>
<td>How long to wait for connections to initialize; defaults to 10 seconds</td>
</tr>
<tr>
<td>readTimeout</td>
<td>optional</td>
<td>How long to wait for reads from the endpoint; defaults to 10 seconds</td>
</tr>
<tr>
<td>writeTimeout</td>
<td>optional</td>
<td>How long to wait for writes from the endpoint; defaults to 10 seconds</td>
</tr>
<tr>
<td>keystorePath</td>
<td>optional</td>
<td>Used for mutual TLS authentication; should point to a Java keystore file holding the client certificate</td>
</tr>
<tr>
<td>keystorePassword</td>
<td>optional</td>
<td>Password used to access the Java keystore for mutual authentication; should be specified in clear text</td>
</tr>
<tr>
<td>sslContextAlgorithm</td>
<td>optional</td>
<td>Specifies the <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext">algorithm</a> to use for opening secure connections to this endpoint; if not specified, defaults to <strong>TLSv1.2</strong></td>
</tr>
</tbody></table>
<h2 id='token-based-authentication'>Token-based authentication</h2>
<blockquote>
<p>Refocus: JWT token</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-token"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-refocus-instance/v1/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE64-encoded-Refocus-token"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Argus: refresh token</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-argus-instance/argusws/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE64-encoded-Argus-refresh-token"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Both Argus and Refocus support authentication with tokens. This is generally more secure than the username / password method (which exposes a larger attack surface).</p>

<p>Read more about Argus&#39;s <a href="https://github.com/salesforce/Argus/wiki/Token-Based-Authentication">token-based authentication</a> and Refocus&#39;s <a href="https://salesforce.github.io/refocus/docs/10-security.html">security</a> page.</p>

<aside class="notice">In Pyplyn, token-based authentication to external systems is supported by defining the <strong>username as _null_</strong> in combination with a <strong>BASE64-encoded token value</strong> specified as a password value.</aside>
<h2 id='mutual-tls-authentication'>Mutual TLS authentication</h2>
<blockquote>
<p>Argus: with mutual TLS authentication</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"endpoint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://url-to-your-argus-instance/argusws/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"keystorePath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/keystore.jks"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"keystorePassword"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password-in-clear-text"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sslContextAlgorithm"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TLSv1.2"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Additionally, Pyplyn supports sending a <em>client TLS certificate</em>, to be used as proof of identity when communicating with remote systems.  To do that, define the following parameters in your connector:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>keystorePath</td>
<td>required</td>
<td>The value should point to a Java keystore file holding the client TLS certificate</td>
</tr>
<tr>
<td>keystorePassword</td>
<td>required</td>
<td>The password used to access keystore file; this string <strong>should be <a href="#base64-mime-encoding">BASE64 encoded</a></strong></td>
</tr>
<tr>
<td>sslContextAlgorithm</td>
<td>optional</td>
<td>Specifies the <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext">algorithm</a> to use for opening secure connections to this endpoint; if not specified, defaults to <strong>TLSv1.2</strong></td>
</tr>
</tbody></table>
<h2 id='configurations'>Configurations</h2>
<blockquote>
<p>Example of a configuration object:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"repeatIntervalMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"extract"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"cacheMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
      </span><span class="s2">"defaultValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"expression"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SUM(-6m:-1m:scope:metric{tags}:avg:1m-max,#1m#)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-result-name"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"transform"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LastDatapoint"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Threshold"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"criticalThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">500.0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"warningThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"infoThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
      </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"GREATER_THAN"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"applyToMetricName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-result-name"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"load"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Refocus"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-default"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"subject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"root.subject.path"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"aspect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AN_ASPECT"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"relatedLinks"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Link title"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://path/to/your/site"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>A Pyplyn <a href="https://github.com/salesforce/pyplyn/blob/master/plugin-api/src/main/java/com/salesforce/pyplyn/configuration/Configuration.java">Configuration</a> is an encompassing model that represents processing logic: where the input data originates from (<em>extract</em>),
how it should be processed (<em>transform</em>), and where it should be published to (<em>load</em>).</p>

<p>Configurations are loaded from a directory specified in <code>AppConfig.configurationsPath</code>.  Each file contains an array of zero or more configurations.  During startup and periodically at the duration specified in <code>AppConfig.Global.updateConfigurationIntervalMillis</code>, all <code>.json</code> files in this directory are deserialized and all configurations are loaded for processing.</p>

<aside class="notice">From a functional standpoint, there is no difference if you structure all your configurations in a single file, or you create one file for each configuration.</aside>

<p>The configuration object&#39;s parameters are explained below:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>repeatIntervalMillis</td>
<td>required</td>
<td>The frequency at which the configuration is executed.  Currently, the implementation does not allow configuration runs to overlap (the same configuration will not be executed until a previous run finishes processing).</td>
</tr>
<tr>
<td>extract</td>
<td>required</td>
<td>Array of sources from which data is to be extracted.  See the <a href="#data-sources">data sources</a> section below.</td>
</tr>
<tr>
<td>transform</td>
<td>required</td>
<td>Array of transformation plugins that are applied sequentially to the incoming data.  See the <a href="#transformations">Transformations</a> section for details on available classes and their functionality.</td>
</tr>
<tr>
<td>load</td>
<td>required</td>
<td>Array which specifies the destination to where the transformed data is to be sent.  See the <a href="#load-destinations">Load destinations</a> section for additional details.</td>
</tr>
<tr>
<td>disabled</td>
<td>optional</td>
<td>Set to <em>false</em> by default; if set to <em>true</em>, the configuration will not be processed, allowing for easy management of configuration objects, without having to delete them from Pyplyn&#39;s <code>configurations</code> directory.</td>
</tr>
</tbody></table>

<aside class="notice">Pyplyn was built with extensibility in mind.  If you find that the included list of <em>extract</em>, <em>transform</em>, and <em>load</em> implementations are not sufficient, you can easily define new ones;  consult the <a href="#extending-pyplyn">extending Pyplyn</a> section for more details!</aside>
<h2 id='transmutation'>Transmutation</h2>
<p>A <a href="https://github.com/salesforce/pyplyn/blob/master/blob/master/plugin-api/src/main/java/com/salesforce/pyplyn/model/Transmutation.java">Transmutation</a> is the model representing data as it flows through and is transformed by Pyplyn&#39;s plugins.</p>
<h1 id='data-sources'>Data sources</h1><h2 id='argus'>Argus</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expression"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SUM(-6m:-1m:scope:metric{tags}:avg:1m-max,#1m#)"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cacheMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"defaultValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-result-name"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Argus is a time-series data collection, visualization, and monitoring service that provides both near-real-time and historical insights to your enterprise data. </p>

<p>Any <a href="https://github.com/salesforce/Argus/wiki/Metric">metric</a> can be retrieved by specifying a few parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>endpoint</td>
<td>required</td>
<td>Identifies the connector to use (the connection on which this expression will be run on); read more in the (connectors)[#connectors] section</td>
</tr>
<tr>
<td>expression</td>
<td>required</td>
<td>Any valid Argus expression used to load and <a href="https://github.com/salesforce/Argus/wiki/Transforms">transform</a> <a href="https://github.com/salesforce/Argus/wiki/Metrics">metrics</a></td>
</tr>
<tr>
<td>cacheMillis</td>
<td>optional</td>
<td>How long to cache this expression&#39;s results (in ms); if the same <em>expression</em> is queried on the same <em>endpoint</em> before this duration expires, the first (cached) result will be returned</td>
</tr>
<tr>
<td>defaultValue</td>
<td>optional</td>
<td>If no results are returned from the endpoint, having this parameter specified causes the processor to generate one data point with this value and the time set to the moment of execution</td>
</tr>
<tr>
<td>name</td>
<td>required</td>
<td>Used to identify the time series returned by the specified expression, in downstream <em>transforms</em></td>
</tr>
</tbody></table>
<h2 id='influxdb'>InfluxDB</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"InfluxDB"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb-database-name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT time, value FROM a_measurement WHERE time &gt;= now() - 1m"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb-result-name"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p><a href="https://www.influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is a time-series data store that can store and query large amounts of time-stamped data.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>endpoint</td>
<td>required</td>
<td>Identifies the connector to use; for InfluxDB, this should match the <a href="https://docs.influxdata.com/influxdb/v1.3/guides/querying_data/#querying-data-using-the-http-api">database name</a> where the queried measurement exists</td>
</tr>
<tr>
<td>query</td>
<td>required</td>
<td>Represents the measurement to load data for; Please ensure the <strong>time</strong> and <strong>value</strong> columns are included, by writing your queries as: <code>SELECT * ...</code> or <code>SELECT time, value ...</code></td>
</tr>
<tr>
<td>name</td>
<td>required</td>
<td>Used to identify the time series returned by the specified expression, in downstream <em>transforms</em></td>
</tr>
</tbody></table>

<aside class="notice">At the moment, the <strong>InfluxDB</strong> implementation in Pyplyn <strong>does not support authentication!</strong></aside>
<h2 id='refocus'>Refocus</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Refocus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-prod"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"subject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA.California.*"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"actualSubject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA.California.San_Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"aspect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Population"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cacheMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"defaultValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<blockquote>
<p><em>Wildcards</em> can be used in combination with <em>cacheMillis</em>, to retrieve and cache all subjects with a determined parent (<code>USA.California</code>) and then return only the value named by <code>actualSubject</code> (<code>San_Francisco</code>); see the example below:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Refocus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"subject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA.California.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"actualSubject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA.California.San_Francisco"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cacheMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Refocus gives engineers a high-level overview over the health and status of systems and services.  Data can not only be uploaded (see the <a href="#refocus-as-a-destination">Refocus load destination</a> section for more details) but also extracted.</p>

<p>The following parameters show how <a href="https://salesforce.github.io/refocus/docs/01-quickstart.html#sample">samples</a> can be extracted from Refocus:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>endpoint</td>
<td>required</td>
<td>Identifies the connector to use (the connection on which this expression will be run on); read more in the (connectors)[#connectors] section</td>
</tr>
<tr>
<td>subject</td>
<td>required</td>
<td>Represents the subject to load; this can either be a full subject name (<code>USA.California.San_Francisco</code>) or a wildcard, e.g., <code>USA.California.*</code></td>
</tr>
<tr>
<td>actualSubject</td>
<td>optional</td>
<td>Specified only if a wildcard was used for <em>subject</em>; it will identify the actual value to return, e.g., <code>USA.California.San_Francisco</code></td>
</tr>
<tr>
<td>aspect</td>
<td>required</td>
<td>The aspect whose value you want to retrieve, e.g., <code>Population</code></td>
</tr>
<tr>
<td>cacheMillis</td>
<td>optional</td>
<td>How long to cache this expression&#39;s results (in ms); if the same <em>subject</em> and <em>aspect</em> are queried on the same <em>endpoint</em> before this duration expires the (cached) result set will be used to return the value named by <code>actualSubject</code></td>
</tr>
<tr>
<td>defaultValue</td>
<td>optional</td>
<td>If no results are returned from the endpoint, having this parameter specified causes the processor to generate one data point with this value and the time set to the moment of execution</td>
</tr>
</tbody></table>
<h1 id='transformations'>Transformations</h1><h2 id='highestvalue'>HighestValue</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-2m:-1m:metric1"</span><span class="p">,</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-2m:-1m:metric2"</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">],</span><span class="w">
</span><span class="s2">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HighestValue"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"messageCodeSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ORIGINAL_VALUE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"tagMessageBody"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ORIGINAL_TIMESTAMP"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This transformation is effective in retrieving the most critical value from a set of sources.  For example, consider the example configuration &gt;&gt;&gt;</p>

<p>If <em>metric1</em> would return <strong>1.0</strong> and <em>metric2</em> would return <strong>2.0</strong>, applying <strong>HighestValue</strong> would result in a single data point of <em>metric2</em>=<strong>2.0</strong>.</p>
<h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>messageCodeSource</td>
<td>optional</td>
<td>This parameter can either be skipped or assigned to a string value of <em>&quot;ORIGINAL_VALUE&quot;</em>; if specified, it will result in setting the <code>Transmutation.Metadata#messageCode</code> to the corresponding value (for each result), formatted to five characters-max; NOTE: any values between minus one and one (-1,1) will be evaluated as zero (0)</td>
</tr>
<tr>
<td>tagMessageBody</td>
<td>optional</td>
<td>This parameter can either be skipped or set to a string value of <em>&quot;ORIGINAL_TIMESTAMP&quot;</em>; if set, it will result in the value&#39;s timestamp to be added to <code>Transmutation.Metadata#messages</code></td>
</tr>
</tbody></table>

<p>This plugin is used in combination with <a href="#threshold">Threshold</a>.  Together they can achieve the effect of grouping multiple time series together, interpreting which has the most urgency (based on their status), and displaying that as a single Refocus ASPECT.</p>

<p><br/></p>

<aside class="notice">What is a <strong>Transmutation's Metadata</strong> ?</aside>

<blockquote>
<p>Assume the following time series are processed with the <em>HighestValue</em> transform (with both <em>messageCodeSource</em> and <em>tagMessageBody</em> flags set):</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># time series</span>
USA.California.San_Francisco|TEMPERATURE<span class="o">=[{</span><span class="nb">time</span>: <span class="s2">"1507047897"</span>, value: <span class="s2">"60"</span><span class="o">}]</span>
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[{</span><span class="nb">time</span>: <span class="s2">"1507032000"</span>, value: <span class="s2">"68"</span><span class="o">}]</span>

<span class="c"># apply HighestValue</span>
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[</span>68]

<span class="c"># the resulting Transmutation will contain the following values:</span>
- <span class="nb">time</span>: 1507032000
- name: USA.California.Los_Angeles|TEMPERATURE
- value: 68.0
- metadata:
  - <span class="nv">messageCode</span><span class="o">=</span><span class="s2">"68.0"</span>
  - messages:
    - Original <span class="nb">time</span>: 2017-10-03T12:00:00Z
</code></pre>
<p>As data flows through Pyplyn, metadata can be added to offer <a href="#load-destinations">Load destinations</a> more context about state transformations.  Metadata is captured in each <a href="#transmutation">Transmutation</a> object that is returned by various <em>transform</em> plugins.</p>

<p>An explanation of how the <em>HighestValue</em> plugin achieves this behavior can be seen in the example to the right:</p>
<h2 id='infostatus'>InfoStatus</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"InfoStatus"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Since <em>OK</em> statuses are not displayed by default in <a href="#refocus">Refocus</a>, you can use this plugin to remap values of zero to <strong>one</strong> (1.0).  This plugin should be included after the <a href="#threshold">Threshold</a> plugin and assumes that the target Refocus aspects are configured such as <a href="#refocus-aspect">described here</a>.</p>
<h2 id='metadata'>Metadata</h2><pre class="highlight json tab-json"><code><span class="s2">"extract"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Metadata"</span><span class="w">
    </span><span class="s2">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>This plugin allows you to define (key, value) pairs to be included in each <a href="#transmutation">transmutation</a>&#39;s metadata.</p>

<aside class="warning">The default behavior is to override any previously defined tags (e.g., by including the <em>Metadata</em> plugin multiple times.</aside>

<aside class="notice">This plugin is not used by any transform plugins or load destinations in the current release (10.x.x).</aside>
<h2 id='lastdatapoint'>LastDatapoint</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LastDatapoint"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This plugin filters out a time-series result, returning only the most recent value. For example, imagine a time-series is an array of values, as seen in the example to the right:</p>
<pre class="highlight plaintext"><code>input: [1, 2, 3, 4, ..., 100]
output: [100]
</code></pre><h2 id='savemetricmetadata'>SaveMetricMetadata</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SaveMetricMetadata"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Assume the following two time series are processed with the <em>LastDatapoint</em>, <em>HighestValue</em> and <em>SaveMetricMetadata</em> transforms:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># time series</span>
USA.California.San_Francisco|TEMPERATURE<span class="o">=[</span>50, 60, 60]
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[</span>60, 70, 60, 68]

<span class="c"># apply LastDatapoint</span>
USA.California.San_Francisco|TEMPERATURE<span class="o">=[</span>60]
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[</span>68]

<span class="c"># apply SaveMetricMetadata (more below)</span>

<span class="c"># apply HighestValue</span>
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[</span>68]

<span class="c"># without SaveMetricMetadata, only one of the two metrics would be included</span>

<span class="c"># with SaveMetricMetadata, all the metrics' values would be included as metadata</span>
USA.California.Los_Angeles|TEMPERATURE<span class="o">=[</span>68]
Metadata:
  USA.California.San_Francisco|TEMPERATURE <span class="o">=</span> 60
  USA.California.Los_Angeles|TEMPERATURE <span class="o">=</span> 68
</code></pre>
<p>This functionality can be useful when using a combination of multiple <a href="#sources">extract</a> and the <a href="#highestvalue">HighestValue</a> plugin, which computes the result by choosing the most critical source, but does not include any information about the other ones.</p>

<p>Use <em>SaveMetricMetadata</em> to include key-value pairs of (name, value) for each source.  These are captured as <a href="#transmutation">transmutation</a> metadata messages.</p>
<h2 id='threshold'>Threshold</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Threshold"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"criticalThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">500.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warningThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"infoThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">100.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"GREATER_THAN"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The <em>Threshold</em> plugin can be used to customize and give meaning to the status of a series of metrics, taking their context into account.</p>

<p>It works by bucketing the four statuses as integers ranging from 0 to 3, which in-turn can be interpreted by Load destinations such as <a href="#refocus-as-a-destination">Refocus</a>.</p>
<h3 id='parameters-2'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>optional</td>
<td>Can be set to GREATER_THAN, LESS_THAN to define how values are compared against the specified threshold parameters;  If a <em>type</em> is no specified, it will cause the plugin to return the same inputs it was passed</td>
</tr>
<tr>
<td>criticalThreshold</td>
<td>optional</td>
<td>Determines where the CRIT interval starts; leave null to skip</td>
</tr>
<tr>
<td>warningThreshold</td>
<td>optional</td>
<td>Determines where the WARN interval starts; leave null to skip</td>
</tr>
<tr>
<td>infoThreshold</td>
<td>optional</td>
<td>Determines where the INFO interval starts; leave null to skip</td>
</tr>
<tr>
<td>okThreshold</td>
<td>optional</td>
<td>Determines what makes an OK status</td>
</tr>
<tr>
<td>applyToMetricName</td>
<td>optional</td>
<td>If specified, the current transform will only be applied to <code>Transmutation</code>s whose name matches this value</td>
</tr>
</tbody></table>

<aside class="notice">Thresholds are evaluated from most critical to least critical. The first one that matches is returned.</aside>

<aside class="notice">A great deal of flexibility can be achieved by skipping some of the thresholds; for example setting <em>criticalThreshold=null</em>, will cause the configuration to at most set a <em>WARN</em> status.</aside>
<h2 id='thresholdmetforduration'>ThresholdMetForDuration</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ThresholdMetForDuration"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"GREATER_THAN"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"threshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">80.0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"criticalDurationMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">120000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warnDurationMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"infoDurationMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">30000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Similar to the <a href="#threshold">Threshold</a> plugin, with the difference that this plugin determines the status of a data point by the duration for which a certain value was exceeded (or fell behind).</p>
<h3 id='parameters-3'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>required</td>
<td>Can be set to GREATER_THAN, LESS_THAN to define how values are compared against the specified threshold parameter</td>
</tr>
<tr>
<td>threshold</td>
<td>required</td>
<td>The value which a value has to exceed or fall behind, depending on the chosen <em>type</em></td>
</tr>
<tr>
<td>criticalDurationMillis</td>
<td>required</td>
<td>Determines how long the threshold has to be exceeded to return a status of CRIT</td>
</tr>
<tr>
<td>warnDurationMillis</td>
<td>required</td>
<td>Determines how long the threshold has to be exceeded to return a status of WARN</td>
</tr>
<tr>
<td>infoDurationMillis</td>
<td>required</td>
<td>Determines how long the threshold has to be exceeded to return a status of INFO</td>
</tr>
</tbody></table>
<h1 id='load-destinations'>Load destinations</h1>
<p>At this time <em>Pyplyn</em> only supports publishing results to Refocus.  More load destinations are planned in a <a href="#planned-future-changes">future release</a>.  </p>

<p>You can, however, make use of Pyplyn&#39;s ability to post the same results to multiple destinations, and publish to more than one Refocus endpoint!</p>
<h2 id='refocus-as-a-destination'>Refocus as a destination</h2>
<blockquote>
<p>For a subject of <em>USA.California.San_Francisco</em> and an aspect of <em>Population</em>, the Pyplyn <em>load</em> section of the configuration would look as follows:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="s2">"load"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Refocus"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-default"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"subject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"USA.California.San_Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"aspect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Population"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"relatedLinks"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Refocus is a platform for visualizing the health and status of systems and services.  Data in Refocus is represented by <a href="https://salesforce.github.io/refocus/docs/01-quickstart.html#sample">Samples</a>, which point to the value of an <a href="https://salesforce.github.io/refocus/docs/01-quickstart.html#aspect">aspect</a> for a specified <a href="https://salesforce.github.io/refocus/docs/01-quickstart.html#subject">subject</a> at a given point in time (which is usually, very close to real-time).</p>

<p>Subjects introduce the concept of paths, where each can have multiple parents forming a 1:N relationship and allowing developers to structure the resulting dashboard in a way that makes sense for the observed system.</p>

<p>See the <a href="#setting-up-refocus">Refocus configuration</a> section below, to read about how aspects can be defined in Refocus, to be used in combination with the <a href="#threshold">Threshold</a> plugin.</p>

<aside class="notice">A Refocus sample's name is always formed by concatenating its subject path and aspect and using the 'pipe' character to separate them, e.g., <strong>USA.California.San_Francisco|Population</strong></aside>
<h3 id='parameters-4'>Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>format</td>
<td>required</td>
<td>Should be set to &quot;Refocus&quot;</td>
</tr>
<tr>
<td>endpoint</td>
<td>required</td>
<td>Identifies the connector to use when uploading this sample; read more in the (connectors)[#connectors] section</td>
</tr>
<tr>
<td>subject</td>
<td>required</td>
<td>The subject path that defines the sample</td>
</tr>
<tr>
<td>aspect</td>
<td>required</td>
<td>The aspect name that defines the sample</td>
</tr>
<tr>
<td>relatedLinks</td>
<td>optional</td>
<td>A list of links that will be associated with the published Sample; should specify two parameters, <em>name</em> and <em>URL</em></td>
</tr>
</tbody></table>
<h1 id='quickstart'>Quickstart</h1>
<p>This section is meant to provide a step-by-step tutorial, showcasing how Pyplyn can be used to populate a Refocus dashboard using data originating from Argus.  For this example we will utilize one of Argus&#39; internal metrics, which specifies how much free memory is available in the system (<code>argus.jvm:mem.physical.free</code>).</p>
<h2 id='prerequisites'>Prerequisites</h2><h3 id='argus-2'>Argus</h3>
<p>Check out Argus&#39; <a href="https://github.com/salesforce/argus/wiki/Getting-Started">Getting started</a> wiki page on how to install it.</p>
<h3 id='refocus-2'>Refocus</h3>
<blockquote>
<p>Define an aspect</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FREE_MEM"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"criticalRange"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">
  </span><span class="s2">"warningRange"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span><span class="w">
  </span><span class="s2">"infoRange"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w">
  </span><span class="s2">"okRange"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Root subject (<em>Monitor</em>)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Monitor"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"isPublished"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Child subjects (<em>Monitor.System</em> and <em>Monitor.System.Argus</em>); please refer to the <a href="https://salesforce.github.io/refocus/docs/01-quickstart#create-a-root-subject">Refocus manual</a> on how to create a subject hierarchy </p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="s2">"System"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"isPublished"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Create a perspective (after you&#39;ve uploaded a lens and <a href="http://refocus/v1/lenses">retrieved</a> its id)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ArgusFreeMemory"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lensId"</span><span class="p">:</span><span class="s2">"your-lensId-goes-here"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"rootSubject"</span><span class="p">:</span><span class="s2">"Monitor"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Refocus can be either installed to Heroku with a <a href="https://salesforce.github.io/refocus/docs/03-quickstartheroku.html">one-button deploy</a>, installed <a href="https://salesforce.github.io/refocus/docs/04-quickstartlocal.html">locally</a>, or in a <a href="https://salesforce.github.io/refocus/docs/05-quickstartlocaldocker.html">Docker container</a>.</p>

<p>Once Refocus was installed, define the <strong>PYPLYN_DEMO</strong> aspect, either with the <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en">Postman Chrome extension</a> (collection <a href="https://www.getpostman.com/collections/ee282b22f7b566eb437e">here</a>) or with <code>curl</code>.</p>

<p>Similarly, define the <em>Monitor</em>, <em>Monitor.System</em>, and <em>Monitor.System.Argus</em> subjects.</p>

<p>You will also need to <a href="https://salesforce.github.io/refocus/docs/01-quickstart#step-4-install-a-lens">install a lens</a> and <a href="https://salesforce.github.io/refocus/docs/01-quickstart#step-5-create-a-perspective">create a perspective</a>.</p>

<p>For this demo, you can skip enforcing security in Refocus. For production deployments, check out the <a href="https://salesforce.github.io/refocus/docs/10-security.html">Refocus&#39; security options</a> page for additional information!</p>
<h3 id='maven'>Maven</h3>
<p><a href="https://maven.apache.org/">Maven</a> is a Java build tool (among other things), and it&#39;s used to compile and package the Pyplyn project as an executable.</p>

<p>If you&#39;re using a Mac, you can install it with <a href="http://brewformulas.org/Maven">Homebrew</a>; if you&#39;re on Linux you can use package managers such as <code>yum</code> or <code>apt-get</code>, otherwise check-out the <a href="https://maven.apache.org/guides/getting-started/windows-prerequisites.html">Maven on Windows</a> page. We recommend <code>Apache Maven 3.3.9</code>.</p>
<h3 id='java-8'>JAVA 8</h3>
<p>This should be available on most modern systems. However, you can install it with the same tools listed above. We recommend at least version <code>1.8.0_131</code>.</p>
<h2 id='configure-and-run-pyplyn'>Configure and run Pyplyn</h2><pre class="highlight shell"><code><span class="c"># Clone the Pyplyn repository</span>
git clone https://github.com/salesforce/pyplyn /tmp/pyplyn
</code></pre><pre class="highlight shell"><code><span class="c"># Build the project with Maven</span>
<span class="nb">cd</span> /tmp/pyplyn
mvn clean package
</code></pre>
<p>After you finish building Pyplyn, you will have the following files in the <code>target/</code> directory:</p>

<ul>
<li><code>pyplyn-[VERSION].jar</code>: an executable (<a href="https://maven.apache.org/plugins/maven-shade-plugin/">shaded</a>) JAR file that contains all its required dependencies</li>
<li><code>bin/pyplyn.sh</code>: a script that simplifies starting and stopping Pyplyn as a service</li>
<li><code>config/</code>: a directory containing example Pyplyn configurations, so you don&#39;t have to write these from scratch; the most important are:

<ul>
<li><code>config/app-config.example.json</code>: this is the main config and determines where the connectors and configurations can be found</li>
<li><code>config/connectors.example.json</code>: all the remote services (and credentials) accessed/required by Pyplyn need to be listed in this file</li>
</ul></li>
</ul>
<pre class="highlight shell"><code><span class="c"># 1. Create a directory</span>
mkdir ~/pyplyn

<span class="c"># 2. Copy Pyplyn's files (this assumes you've cloned Pyplyn in `/tmp/pyplyn`)</span>
cp -R /tmp/pyplyn/target/pyplyn-<span class="k">*</span>.jar /tmp/pyplyn/target/config /tmp/pyplyn/target/bin ~/pyplyn/

<span class="c"># 3. Create directories for your configurations</span>
mkdir ~/pyplyn/config <span class="o">&amp;&amp;</span> mkdir ~/pyplyn/config/configurations

<span class="c"># 4. Rename app-config.example.json and make the required changes</span>
mv ~/pyplyn/config/app-config.example.json ~/pyplyn/config/pyplyn-config.json

<span class="c"># 5. Rename connectors.example.json and make the required changes (see below)</span>
mv ~/pyplyn/config/connectors.example.json ~/pyplyn/config/connectors.json
</code></pre>
<blockquote>
<p>5. Define connectors
<code>json
[
  {
    &quot;id&quot;: &quot;refocus-token-connector&quot;,
    &quot;endpoint&quot;: &quot;https://url-to-your-refocus-instance/v1/&quot;,
    &quot;username&quot;: null,
    &quot;password&quot;: &quot;BASE64-encoded-Refocus-token&quot;
  },
  {
    &quot;id&quot;: &quot;argus-token-connector&quot;,
    &quot;endpoint&quot;: &quot;https://url-to-your-argus-instance/argusws/&quot;,
    &quot;username&quot;: null,
    &quot;password&quot;: &quot;BASE64-encoded-Argus-refresh-token&quot;
  }
]
</code></p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># 6\. Edit ~/pyplyn/bin/pyplyn.sh and set _LOCATION_ to the absolute path of the _pyplyn_ directory (optional)</span>
<span class="nv">LOCATION</span><span class="o">=</span>/path/to/pyplyn

<span class="c"># 7\. Start pyplyn and check logs</span>
bash ~/pyplyn/bin/pyplyn.sh start

<span class="c"># Should not display any exceptions</span>
bash ~/pyplyn/bin/pyplyn.sh logs
</code></pre>
<p>1. First, it is important to create a dedicated directory to hold your files (since if left in the default location they would get erased every time you executed <code>mvn clean</code>)</p>

<p>2. Create a directory (e.g., <code>~/pyplyn</code>) and copy the generated artifacts</p>

<p>3. Also create <code>~/pyplyn/config</code> and <code>~/pyplyn/config/configurations</code></p>

<p>4. Rename <em>app-config.example.json</em> to <em>pyplyn-config</em>.json and set the following:
  - <code>configurationsPath</code>: &quot;./config/configurations&quot;
  - <code>connectorsPath</code>: &quot;./config/connectors.json&quot;
  - <code>updateConfigurationIntervalMillis</code>: 10000</p>

<p>5. Rename <em>connectors.example.json</em> to <em>connectors.json</em>, erase existing contents, and define Argus and Refocus connectors; don&#39;t forget to update the endpoints, <a href="#base64-mime-encoding">BASE64 encode</a> your access tokens, and update their values in this file!</p>

<p>6. Update the startup script and update <strong>LOCATION</strong></p>

<aside class="notice">NOTE: if not running in a Linux environment, you will have to also replace <code>/var/run</code> with a path that exists, for both <em>PIDFILE</em> and <em>LOGFILE</em> in this script!</aside>

<p>7. Run Pyplyn, which should start and not throw any exceptions!</p>

<p>If you do see any Java exceptions, re-check your paths and all steps outlined above; in general, Pyplyn&#39;s errors have enough information to point you to the actual problem and give you an idea of what needs to be done to resolve any issues.  If however, you are blocked, please <a href="https://github.com/salesforce/pyplyn/issues/new">open a new issue on GitHub</a>, and we&#39;ll help you out as soon as we can!</p>
<h2 id='base64-mime-encoding'>BASE64-MIME encoding</h2><pre class="highlight shell"><code><span class="c"># One simple way to achieve this is the following command</span>
perl -e <span class="s1">'use MIME::Base64; print encode_base64("PASSWORD");'</span>
</code></pre>
<aside class="warning">NOTE: <strong>All password strings (including tokens) need to be encoded with the BASE64-MIME variant!</strong></aside>
<h2 id='create-a-configuration-for-processing'>Create a configuration for processing</h2>
<blockquote>
<p>Create a new file named <code>~/pyplyn/config/configurations/one.json</code> and paste the following:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"repeatIntervalMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"extract"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Argus"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-token-connector"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"cacheMillis"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"defaultValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"expression"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"-60s:-0s:argus.jvm:mem.physical.free:avg"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-avg-free-mem"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"transform"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LastDatapoint"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Threshold"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"criticalThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">2147483648.0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"warningThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">4294967296.0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"infoThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">8589934592.0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"LESS_THAN"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"applyToMetricName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"argus-avg-free-mem"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"load"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Refocus"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"endpoint"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"refocus-token-connector"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subject"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Monitor.System.Argus"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"aspect"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FREE_MEM"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"relatedLinks"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
<p>Now that you have Pyplyn up and running, you are ready to write your first configuration.</p>

<p>In Pyplyn terminology, a configuration is a JSON object which specifies where the data is extracted from, how it should be processed (transformed), and where it should be published to.</p>

<p>Let&#39;s analyze each section:</p>

<ul>
<li><em>repeatIntervalMillis</em>: is set to repeat every 60000 ms (60 seconds)</li>
<li><em>extract</em>: We will retrieve one of Argus&#39; internal metrics that tracks free memory from <em>argus-token-connector</em> (specified in <code>connectors.json</code>);  if no data is found, we will return a <code>defaultValue</code> of <em>0.0</em></li>
<li><em>transform</em>:

<ul>
<li>First, we filter all but the last datapoint;</li>
<li>Then we apply the <a href="#threshold">Threshold</a> plugin</li>
<li>And consider anything less than 2GB to be CRITICAL, 4GB to be a WARNING, and 8GB to be INFO</li>
</ul></li>
<li><em>load</em>: Finally, after all the transformations have been applied, we load the resulting data in a Refocus sample named <code>Monitor.System.Argus|FREE_MEM</code>, on the endpoint defined by <em>refocus-token-connector</em></li>
</ul>

<p>Save this file in the <code>~pyplyn/configuration/</code> directory and issue a <code>bin/pyplyn.sh logs</code> command; within the next 10 seconds, you should see a message showing that a new configuration was loaded and then executed.  Open the Refocus perspective you created (<em>ArgusFreeMemory</em>), and you will see an entry for this sample!</p>
<h2 id='startup-script-bin-pyplyn-sh'>Startup script (bin/pyplyn.sh)</h2>
<p>Pyplyn includes a startup script which can be used to manage the service&#39;s lifecycle.</p>

<p>After building the project with <code>mvn package</code>, you will find the script in the <code>[PROJECT_HOME]/target/bin/pyplyn.sh</code>. Also, perform the following steps:</p>

<ul>
<li>Edit this file and set the <em>LOCATION</em> parameter to the location of the Pyplyn JAR.</li>
<li>Make this file executable: <code>chmod u+rx pyplyn.sh</code></li>
</ul>

<p>You can then issue the following commands:</p>

<ul>
<li><code>pyplyn.sh start</code>: starts Pyplyn (configured from <code>[LOCATION]/config/pyplyn-config.json</code>)</li>
<li><code>pyplyn.sh nohup</code>: starts Pyplyn in nohup mode (the service keeps running after you log out)</li>
<li><code>pyplyn.sh stop</code>: stops a running Pyplyn instance, if one exists</li>
<li><code>pyplyn.sh status</code>: checks if the service is running or not</li>
<li><code>pyplyn.sh logs</code>: examines (<code>tail -f</code>) current logs, if the service is started</li>
<li><code>pyplyn.sh restart</code>: re-starts the service</li>
</ul>
<h1 id='extending-pyplyn'>Extending Pyplyn</h1>
<p>This section will give you a quick overview of developing new extract, transform, and load plugins for Pyplyn.</p>

<p>Adding more ways to extract and process data is probably the most common use case you will encounter for extending Pyplyn. However, most of Pyplyn&#39;s other functionality can be extended or replaced by changing the list of <em>Guice</em> injector modules defined in <a href="https://github.com/salesforce/pyplyn/blob/master/blob/master/duct/src/main/java/com/salesforce/pyplyn/duct/app/AppBootstrap.java">AppBootstrap#modules()</a>.</p>

<p>While you can easily fork the project and modify its source code, we do not recommend this approach.</p>

<blockquote>
<p>Import the <code>duct</code> module, which encapsulates the processing and runtime logic</p>
</blockquote>
<pre class="highlight xml tab-xml"><code><span class="c">&lt;!-- pom.xml --&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.salesforce.pyplyn<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>duct<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>10.0.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre>
<blockquote>
<p>NOTE: you will need to first <a href="#configure-and-run-pyplyn">clone</a> and install (<code>mvn clean install</code>) Pyplyn before being able to use the dependency above, since Pyplyn is not currently deployed in any global Maven repositories.</p>
</blockquote>

<p>Instead, we propose you create a new Maven project that imports <code>Pyplyn</code> as a <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">dependency</a>.  This approach has the benefit of not having to maintain a forked project and integrate changes when upgrading to a newer version!</p>

<p>After you&#39;ve developed and tested a new feature, you can still <a href="#contributing-to-pyplyn">contribute</a> your changes back into Pyplyn.</p>
<h2 id='common-use-cases'>Common use-cases</h2>
<ul>
<li>Add other <a href="https://github.com/salesforce/pyplyn/tree/master/duct/src/main/java/com/salesforce/pyplyn/duct/etl/extract">Extract</a> data sources</li>
<li>Create new <a href="https://github.com/salesforce/pyplyn/tree/master/duct/src/main/java/com/salesforce/pyplyn/duct/etl/transform/standard">Transform</a> plugins to apply custom logic to your data</li>
<li>Define other <a href="https://github.com/salesforce/pyplyn/tree/master/duct/src/main/java/com/salesforce/pyplyn/duct/etl/load">Load</a> destinations for sending data to</li>
<li>Augment <a href="https://github.com/salesforce/pyplyn/blob/master/plugin-api/src/main/java/com/salesforce/pyplyn/configuration/EndpointConnector.java">connectors</a> to retrieve credentials from an external system (e.g., a database, remote endpoint, credentials store, etc.)</li>
<li>Add other configuration objects that supplement the options defined in <a href="https://github.com/salesforce/pyplyn/blob/master/duct/src/main/java/com/salesforce/pyplyn/duct/appconfig/AppConfig.java">AppConfig</a></li>
<li>Send monitoring data to other systems and APIs</li>
</ul>
<h2 id='how-do-i-replace-augment-pyplyn-39-s-bootstrap'>How do I replace/augment Pyplyn&#39;s bootstrap?</h2>
<blockquote>
<p>1. Create a new bootstrap class</p>
</blockquote>
<pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.google.inject.Module</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.salesforce.pyplyn.duct.app.AppBootstrap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomPyplynBootstrap</span> <span class="kd">extends</span> <span class="n">AppBootstrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="nf">modules</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// load default Pyplyn modules</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="n">modules</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="kd">super</span><span class="o">.</span><span class="na">modules</span><span class="o">());</span>

    <span class="c1">// add new modules</span>
    <span class="c1">// replace or remove any of the original modules</span>

    <span class="c1">// return the final list, which will be used during bootstrap</span>
    <span class="k">return</span> <span class="n">modules</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<blockquote>
<p>2. Create a new class and reference the newly created bootstrap class</p>
</blockquote>
<pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.salesforce.pyplyn.duct.app.DuctMain</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PyplynExtensionApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// this changes the program's name, when _usage_ information is displayed</span>
    <span class="n">DuctMain</span><span class="o">.</span><span class="na">setProgramName</span><span class="o">(</span><span class="s">"pyplyn-extension"</span><span class="o">);</span>

    <span class="c1">// start Pyplyn with a custom bootstrap</span>
    <span class="n">DuctMain</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">CustomPyplynBootstrap</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>To have Pyplyn start with custom functionality, you will have to (at least) perform the following actions:</p>

<p>1. Create a new bootstrap class that extends <a href="https://github.com/salesforce/pyplyn/blob/master/duct/src/main/java/com/salesforce/pyplyn/duct/app/AppBootstrap.java">AppBootstrap</a>
  - override the <code>AppBootstrap#modules()</code> method and update the list of modules used during bootstrap
  - this list will be passed to the Guice injector and control the final behavior of the program</p>

<p>2. Create a new <code>main(String[])</code> entry-point
  - set the program&#39;s name (only used in <em>usage help</em>), or skip to use the default value of <em>pyplyn</em>
  - call the <code>DuctMain#execute(Class, String[])</code> method, pointing it do your newly created bootstrap class (step 1 above)</p>
<h2 id='how-do-i-create-a-new-transform'>How do I create a new Transform?</h2>
<blockquote>
<p>3. Create a new class (using <a href="http://immutables.github.io/">Immutables</a>)</p>
</blockquote>
<pre class="highlight plaintext"><code>import org.immutables.value.Value;

import com.fasterxml.jackson.annotation.JsonTypeName;
import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import com.fasterxml.jackson.databind.annotation.JsonSerialize;
import com.salesforce.pyplyn.annotations.PyplynImmutableStyle;
import com.salesforce.pyplyn.model.Transform;
import com.salesforce.pyplyn.model.Transmutation;

@Value.Immutable
@PyplynImmutableStyle
@JsonDeserialize(as = ImmutableNewTransformPlugin.class)
@JsonSerialize(as = ImmutableNewTransformPlugin.class)
@JsonTypeName("NewTransformPlugin")
public abstract class NewTransformPlugin implements Transform {
  private static final long serialVersionUID = -1L; // generate a random value

  public abstract String aProperty(); // define properties if required

  @Override
  public List&lt;List&lt;Transmutation&gt;&gt; apply(List&lt;List&lt;Transmutation&gt;&gt; input) {
    // logic goes here
  }
}
</code></pre>
<blockquote>
<p>4. Create a Guice module</p>
</blockquote>
<pre class="highlight plaintext"><code>import com.google.inject.AbstractModule;
import com.salesforce.pyplyn.util.MultibinderFactory;

public class NewTransformPluginModule extends AbstractModule { 
  @Override
  protected void configure() {
    MultibinderFactory.transformFunctions(binder()).addBinding().toInstance(NewTransformPlugin.class);
  }
}
</code></pre>
<blockquote>
<p>5. Add the newly created Guice module in your custom bootstrap</p>
</blockquote>
<pre class="highlight java tab-java"><code><span class="kn">import</span> <span class="nn">com.google.inject.Module</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.salesforce.pyplyn.duct.app.AppBootstrap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomPyplynBootstrap</span> <span class="kd">extends</span> <span class="n">AppBootstrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="nf">modules</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// load default Pyplyn modules</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="n">modules</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="kd">super</span><span class="o">.</span><span class="na">modules</span><span class="o">());</span>

    <span class="c1">// add the new module</span>
    <span class="n">modules</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">NewTransformPluginModule</span><span class="o">());</span>

    <span class="c1">// return the final list, which will be used during bootstrap</span>
    <span class="k">return</span> <span class="n">modules</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>3. Create a new class for the transform plugin 
  - while not required, using the <a href="http://immutables.github.io/">Immutables</a> library, gives you benefits such as guarded values and auto-generated builders, which is extremely useful if you will need to automate the generation of your configurations with other (JAVA-based) tooling
  - define any properties that might be required by your plugin
  - implement the <code>Transform#apply(List)</code> method and write your plugin&#39;s logic
  - <strong>the value specified in <code>@JsonTypeName(String)</code> should be unique across all registered Pyplyn modules for the current type (<em>Transform</em>)</strong>; it will be used to correctly serialize and deserialize JSON strings to their corresponding types
4. Create a Guice module and register your plugin with <code>MultibinderFactory#transformFunctions(Binder)</code>
  - See the <a href="https://github.com/salesforce/pyplyn/blob/release/10/plugin-api/src/main/java/com/salesforce/pyplyn/util/MultibinderFactory.java">MultibinderFactory.java</a> class for other helper methods you can use to register the various types Pyplyn supports
  - You can also consult Pyplyn&#39;s <em>extract</em>, <em>transform</em>, <em>load</em>, etc. implementations in the source code, to understand how these features are implemented; a few links are presented in the <a href="#common-use-cases">common use-cases section</a> above
5. Update the custom bootstrap to include the newly created module</p>
<h2 id='starting-stopping-a-pyplyn-extension-project'>Starting/stopping a Pyplyn-extension project</h2>
<p>You can manage an extension project&#39;s lifecycle similarly as described in the <a href="#configure-and-run-pyplyn">Configure pyplyn</a> and <a href="##startup-script-bin-pyplyn-sh">Startup script</a> sections.</p>

<p>Follow these steps:
- copy the script to a new location and rename it to match your project&#39;s name
- build the extension project (<code>mvn clean package</code>)
- copy the resulting JAR file into this new location
- edit the startup script and update the <code>LOCATION</code> and <code>NAME</code> variables</p>

<aside class="notice">NOTE: these steps imply that you have configured the <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven shade plugin</a> to build an executable jar.  You can find an example in this <a href="https://github.com/salesforce/pyplyn/blob/release/10/duct/pom.xml#L37">pom.xml</a> file</aside>
<h2 id='tech-stack'>Tech stack</h2>
<p>Below you can see the <strong>amazing</strong> open-source technologies that make Pyplyn possible!</p>

<ul>
<li><a href="https://github.com/FasterXML/jackson">Jackson</a></li>
<li><a href="https://github.com/google/guice">Guice</a></li>
<li><a href="https://square.github.io/retrofit/">Retrofit</a></li>
<li><a href="https://github.com/ReactiveX/RxJava">RxJava 2.0</a></li>
<li><a href="https://hazelcast.org/">Hazelcast</a></li>
<li><a href="http://immutables.github.io/">Immutables</a></li>
<li><a href="http://metrics.dropwizard.io/">Dropwizard Metrics</a></li>
</ul>
<h1 id='contributing-to-pyplyn'>Contributing to Pyplyn</h1>
<p>Any contributions (code, artwork, documentation, etc.) will be considered as long as it respects our <a href="#licensing-requirements">licensing requirements</a>, listed below.</p>

<p><strong>All contributors are required to sign the Salesforce Contributor&#39;s License Agreement.</strong>   Please <a href="SFDC_CLA.pdf">print this file</a>, sign it, scan it, and send it to <a href="mailto:osscore@salesforce.com">osscore@salesforce.com</a>.</p>

<p>For more details on the process see <a href="https://github.com/salesforce/pyplyn/blob/master/CONTRIBUTE.md">CONTRIBUTE.MD</a> in our repository.</p>

<p>We look forward to collaborating with you.</p>

<p><strong>Thank you!</strong></p>
<h2 id='licensing-requirements'>Licensing requirements</h2>
<p>For all contributions, we can only accept materials published under the following license types.  Please ensure that your submission respects these guidelines, otherwise, we will not be able to accept them.</p>

<ul>
<li>Apache 2.0</li>
<li>BSD</li>
<li>MIT</li>
<li>ISC</li>
<li>MPL</li>
</ul>

<p><br/>
<br/>
<br/></p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
